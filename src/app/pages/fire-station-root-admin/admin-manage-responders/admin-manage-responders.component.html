<!-- admin-manage-responders.component.html -->
<div class="page-container">

  <!-- HEADER -->
  <div class="header-card">
    <div>
      <h2>Responder Account Management</h2>
      <p class="header-subtitle">Create, update, and manage responder accounts.</p>
    </div>
    <div class="header-actions">
      <button class="add-btn" (click)="openAddModal()">+ Add Responder</button>
    </div>
  </div>

  <!-- RESPONDER TABLE -->
  <div class="table-card">
    <div class="table-title">Responder List</div>

    <div class="responder-table-wrapper">
      <table class="responder-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Station</th>
            <th>Contact</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let r of responderList; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ r.responderName }}</td>
            <td>{{ r.stationName }}</td>
            <td>{{ r.contact }}</td>
            <td>{{ r.email }}</td>
            <td>{{ r.role }}</td>
            <td>
              <span
                [ngClass]="r.status === 'Active' ? 'badge-active' : 'badge-inactive'">
                {{ r.status }}
              </span>
            </td>
            <td class="actions-cell">
              <button class="icon-btn" (click)="openEditModal(r)">Edit</button>
              <button class="icon-btn danger" (click)="confirmDelete(r)">Delete</button>
              <button class="icon-btn" (click)="toggleStatus(r)">
                {{ r.status === 'Active' ? 'Disable' : 'Enable' }}
              </button>
            </td>
          </tr>

          <tr *ngIf="responderList.length === 0">
            <td colspan="8" class="empty">No responders yet. Click “Add Responder” to create one.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- ADD / EDIT MODAL -->
<div class="modal-backdrop" *ngIf="showModal">
  <div class="modal-box">

    <div class="modal-title">
      {{ isEditMode ? 'Edit Responder' : 'Add Responder' }}
    </div>

    <div class="modal-content">
      <div class="form-container">

        <div class="form-group">
          <label>Name *</label>
          <input [(ngModel)]="responderName" type="text" placeholder="Enter responder name">
        </div>

        <div class="form-group">
          <label>Email *</label>
          <input [(ngModel)]="email" type="email" placeholder="Enter email">
        </div>

        <div class="form-group">
          <label>Contact Number *</label>
          <input [(ngModel)]="contact" type="text" placeholder="Contact number">
        </div>

        <div class="form-group">
          <label>Role *</label>
          <select [(ngModel)]="role">
            <option value="">Select Role</option>
            <option value="Responder">Responder</option>
            <option value="Investigator">Investigator</option>
          </select>
        </div>

        <div class="form-group">
          <label>Assign Fire Station *</label>
          <select [(ngModel)]="selectedStationId" (change)="setStationName()">
            <option value="">Select Station</option>
            <option *ngFor="let s of stationList" [value]="s.id">
              {{ s.stationName }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label>Status</label>
          <select [(ngModel)]="status">
            <option>Active</option>
            <option>Inactive</option>
          </select>
        </div>

        <!-- Only show password fields when adding a new responder -->
        <div *ngIf="!isEditMode" class="form-group">
          <label>Password *</label>
          <input [(ngModel)]="password" type="password" placeholder="Password">
        </div>

        <div *ngIf="!isEditMode" class="form-group">
          <label>Confirm Password *</label>
          <input [(ngModel)]="confirmPassword" type="password" placeholder="Confirm password">
        </div>

      </div>
    </div>

    <div class="modal-footer">
      <button class="cancel-btn" (click)="closeModal()">Cancel</button>
      <button class="save-btn" (click)="isEditMode ? updateResponder() : saveResponder()">
        {{ isEditMode ? 'Update' : 'Save' }}
      </button>
    </div>

  </div>
</div>

<!-- DELETE CONFIRM MODAL -->
<div class="modal-backdrop" *ngIf="showDeleteConfirm">
  <div class="modal-box small">
    <div class="modal-title">Confirm Delete</div>
    <div class="modal-content">
      Are you sure you want to delete
      <strong>{{ deleteTarget?.responderName }}</strong>?
      This will remove the responder document from Firestore but will NOT touch Firebase Auth.
    </div>
    <div class="modal-footer">
      <button class="cancel-btn" (click)="cancelDelete()">Cancel</button>
      <button class="save-btn danger" (click)="deleteResponder()">Delete</button>
    </div>
  </div>
</div>

<!-- LOADING OVERLAY -->
<div class="loading-overlay" *ngIf="isLoading">
  <div class="spinner-container">
    <img src="images/ic_logo.png" class="spinner-logo" alt="Logo">
    <div class="spinner"></div>
  </div>
</div>
